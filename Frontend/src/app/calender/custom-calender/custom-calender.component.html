<div class="custom-date-picker" [class.disabled]="disabled">
  <!-- Input Field -->
  <div class="input-container">
    <input
      #dateInput
      type="text"
      class="date-input"
      [formControl]="dateControl"
      [placeholder]="placeholder"
      [attr.aria-label]="selectDateLabel"
      [attr.aria-expanded]="isPopupOpen"
      [attr.aria-haspopup]="true"
      (click)="onInputClick()"
    />
    <button
      type="button"
      class="calendar-icon-btn"
      [disabled]="disabled"
      [attr.aria-label]="selectDateLabel"
      (click)="onCalendarIconClick()"
    >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    </button>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="errorMessage" role="alert">
    {{ errorMessage }}
  </div>

  <!-- Calendar Popup -->
  <div
    #calendarPopup
    class="calendar-popup"
    *ngIf="isPopupOpen"
    role="dialog"
    [attr.aria-label]="selectDateLabel"
  >
    <!-- Calendar Header -->
    <div class="calendar-header">
      <button
        type="button"
        class="nav-button"
        (click)="onPreviousMonth()"
        [attr.aria-label]="'Previous month'"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,18 9,12 15,6"></polyline>
        </svg>
      </button>

      <div class="month-year-selectors">
        <select
          #monthSelect
          class="month-select"
          [value]="currentMonth"
          (change)="onMonthChange(+monthSelect.value)"
          [attr.aria-label]="'Select month'"
        >
          <option *ngFor="let month of monthOptions" [value]="month.value">
            {{ month.label }}
          </option>
        </select>

        <select
          #yearSelect
          class="year-select"
          [value]="currentYear"
          (change)="onYearChange(+yearSelect.value)"
          [attr.aria-label]="'Select year'"
        >
          <option *ngFor="let year of yearOptions" [value]="year">
            {{ year }}
          </option>
        </select>
      </div>

      <button
        type="button"
        class="nav-button"
        (click)="onNextMonth()"
        [attr.aria-label]="'Next month'"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6"></polyline>
        </svg>
      </button>
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-grid">
      <!-- Weekday Headers -->
      <div class="weekday-header" *ngFor="let weekday of weekdaysShort">
        {{ weekday }}
      </div>

      <!-- Date Cells -->
      <button
        type="button"
        class="date-cell"
        *ngFor="let cell of calendarCells"
        [class.other-month]="!cell.isCurrentMonth"
        [class.today]="cell.isToday"
        [class.selected]="cell.isSelected"
        [class.in-range]="cell.isInRange"
        [class.range-start]="cell.isRangeStart"
        [class.range-end]="cell.isRangeEnd"
        [class.disabled]="cell.isDisabled"
        [disabled]="cell.isDisabled"
        [attr.aria-label]="formatDate(cell.date)"
        [attr.aria-selected]="cell.isSelected"
        (click)="onDateCellClick(cell)"
      >
        {{ cell.day }}
      </button>
    </div>

    <!-- Time Picker -->
    <div class="time-picker" *ngIf="showTimePicker && !enableDateRangeSelection">
      <div class="time-selector">
        <label for="hours">Hours:</label>
        <select
          #hoursSelect
          id="hours"
          [value]="selectedTime.hours"
          (change)="onTimeChange('hours', +hoursSelect.value)"
        >
          <option *ngFor="let hour of hourOptions" [value]="hour">
            {{ hour.toString().padStart(2, '0') }}
          </option>
        </select>
      </div>
      <div class="time-selector">
        <label for="minutes">Minutes:</label>
        <select
          #minutesSelect
          id="minutes"
          [value]="selectedTime.minutes"
          (change)="onTimeChange('minutes', +minutesSelect.value)"
        >
          <option *ngFor="let minute of minuteOptions" [value]="minute">
            {{ minute.toString().padStart(2, '0') }}
          </option>
        </select>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="calendar-actions">
      <button type="button" class="action-button today-btn" (click)="onTodayClick()">
        {{ todayLabel }}
      </button>
      <button type="button" class="action-button clear-btn" (click)="onClearClick()">
        {{ clearLabel }}
      </button>
    </div>
  </div>
</div>
